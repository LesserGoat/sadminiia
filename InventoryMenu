package sample;

import javafx.application.Application;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.layout.GridPane;
import javafx.scene.layout.GridPane;
import javafx.stage.Stage;
import javafx.scene.layout.*;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.scene.chart.PieChart;
import javafx.scene.chart.PieChart.Data;
import java.time.format.DateTimeFormatter;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Collections;


import java.io.FileWriter;
import java.util.ArrayList;
import java.io.File;
import java.io.Writer;
import java.util.Scanner;
import javafx.scene.control.*;

public class InventoryMenu {
    public InventoryMenu(){
        ArrayList<Food> str = new ArrayList<Food>();
        ArrayList<Food> searchList = new ArrayList<Food>();
        ArrayList<String> chartString = new ArrayList<String>();
        ArrayList<Integer> chartInteger = new ArrayList<Integer>();

        //create primary Stage
        Stage primaryStage = new Stage();

        //create second stage
        Stage secondStage = new Stage();

        //Create Third Stage
        Stage thirdStage = new Stage();

        //Create Fourth Stage
        Stage fourthStage = new Stage();

        //gridpane roots
        GridPane root = new GridPane();
        GridPane inventory = new GridPane();
        ScrollPane scrollableInventory = new ScrollPane(inventory);
        GridPane inventorySearch = new GridPane();
        ScrollPane scrollableInventorySearch = new ScrollPane(inventory);

        //main root
        TextField nameText = new TextField();
        Label nameLabel = new Label("Food Name:");
        TextField typeText = new TextField();
        Label typeLabel = new Label("Food Type:");
        TextField monthText = new TextField();
        Label amountLabel = new Label("Enter Amount:");
        //Expiration Date
        TextField amountText = new TextField();
        Label dateInfo = new Label("Date is entered MM/DD/YY each input is separate");
        Label monthLabel = new Label("Expiration Month:");
        TextField dateText = new TextField();
        Label dateLabel = new Label("Expiration Day:");
        TextField yearText = new TextField();
        Label yearLabel = new Label("Expiration Year:");
        //Purchase date
        TextField pMonthText = new TextField();
        Label pMonthLabel = new Label("Purchase Month:");
        TextField pDateText = new TextField();
        Label pDateLabel = new Label("Purchase Day:");
        TextField pYearText = new TextField();
        Label pYearLabel = new Label("Purchase Year:");

        Button  SubmitB = new Button("submit");
        Button  viewInventoryB = new Button("View Inventory");
        Button  viewChartB = new Button("View Count Chart");
        Button  inventoryBack = new Button("Back");
        root.add(nameLabel,0,0);
        root.add(nameText,1,0);
        root.add(typeLabel,0,1);
        root.add(typeText,1,1);
        root.add(amountLabel,0,2);
        root.add(amountText,1,2);
        root.add(dateInfo,1,3);
        root.add(monthLabel,0,4);
        root.add(monthText,1,4);
        root.add(dateLabel,0,5);
        root.add(dateText,1,5);
        root.add(yearLabel,0,6);
        root.add(yearText,1,6);
        root.add(pMonthLabel,0,7);
        root.add(pMonthText,1,7);
        root.add(pDateLabel,0,8);
        root.add(pDateText,1,8);
        root.add(pYearLabel,0,9);
        root.add(pYearText,1,9);
        root.add(SubmitB,0,10);
        root.add(viewInventoryB,0,11);
        root.add(inventoryBack,0,12);
        //singular inventory chart thing.
        //inventory.add(viewChartB,1,10);

        //ArrayList<Food> str = new ArrayList<Food>();

        inventoryBack.setOnAction(value ->
        {
            new HomeMenu(primaryStage);
        });

        SubmitB.setOnAction(value ->
        {
            str.removeAll(str);// when using an arraylist that I have used before....I remove ALL of them and then
            String name = nameText.getText();
            String foodType = typeText.getText();
            String fAmount = amountText.getText();
            String expirationMonth = monthText.getText();
            String expirationDate = dateText.getText();
            String expirationYear = yearText.getText();
            String purchaseDate = pMonthText.getText();
            String purchaseMonth = pDateText.getText();
            String purchaseYear = pYearText.getText();
            int foodAmount = Integer.parseInt(fAmount);
            int dateInt = Integer.parseInt(expirationDate);
            int monthInt = Integer.parseInt(expirationMonth);
            int yearInt = Integer.parseInt(expirationYear);
            int pDateInt = Integer.parseInt(purchaseDate);
            int pMonthInt = Integer.parseInt(purchaseMonth);
            int pYearInt = Integer.parseInt(purchaseYear);
            Food foodItem = new Food(name, foodType, foodAmount, monthInt, dateInt, yearInt, pDateInt, pMonthInt, pYearInt);
            str.add(foodItem);
            try{
                Writer w = new FileWriter(UsernameStorage.getUserName()+ContainerNameStorage.getContainerName()+".txt", true);
                for (int i = 0;i<str.size();i++)
                {
                    w.write(str.get(i).writeFood() + "\n");

                }
                w.close();


            }catch (Exception e){System.out.println("error in writing");}

            //Updates upon adding item
            try {
                Scanner s = new Scanner(new File(UsernameStorage.getUserName()+ContainerNameStorage.getContainerName()+".txt"));
                str.removeAll(str);// when using an arraylist that I have used before....I remove ALL of them and then
                //the next line I will add them all back
                while (s.hasNext()) {
                    Food stu = new Food(s.nextLine(), s.nextLine(), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()));
                    str.add(stu); //this will store each line
                }
                //the following creates an arraylist of buttons
                String TempID = "";
                String tempString = "";

                for (int i = 0; i < str.size(); i++)
                {
                    tempString = tempString +str.get(i).toString() + "\n";

                    // The button way
                    TempID = "food" +i;
                    Button but= new Button(str.get(i).toString());
                    but.setId(TempID);
                    inventory.add(but, 1, i);

                    Button removeBut= new Button("x");
                    inventory.add(removeBut, 0, i);


                }

            }
            catch(Exception e){System.out.println("error in reading");}


        });

        Label searchLabel = new Label("Enter name and press enter");
        TextField searchField = new TextField();

        searchField.setOnAction(value ->
        {
            String theName = searchField.getText();
            try {
                Scanner s = new Scanner(new File(UsernameStorage.getUserName()+ContainerNameStorage.getContainerName()+".txt"));
                str.removeAll(str);// when using an arraylist that I have used before....I remove ALL of them and then
                //the next line I will add them all back
                searchList.removeAll(searchList);// when using an arraylist that I have used before....I remove ALL of them and then
                //the next line I will add them all back
                while (s.hasNext()) {
                    Food stu = new Food(s.nextLine(), s.nextLine(), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()));
                    str.add(stu); //this will store each line
                }

                for (int i = 0; i<str.size();i++)
                {

                    if(str.get(i).getName().contains(theName))
                    {
                        searchList.add(str.get(i));
                    }



                }


            }
            catch(Exception e){System.out.println("error in reading for textfield");}

            try{
                //the following creates an arraylist of buttons
                String TempID = "";
                String tempString = "";

                for (int i = 0; i < searchList.size(); i++)
                {
                    tempString = tempString + searchList.get(i).toString() + "\n";

                    // The button way
                    TempID = "food" +i;

                    Button but= new Button(str.get(i).toString());
                    but.setId(TempID);
                    inventory.add(but, 1, i);

                    Button removeBut= new Button("x");
                    inventory.add(removeBut, 0, i);


                }
            }catch(Exception e){System.out.println("error in writing for textfield");}
            //secondStage.show();
            fourthStage.show();



        });

        viewInventoryB.setOnAction(value ->
        {
            try {
                Scanner s = new Scanner(new File(UsernameStorage.getUserName()+ContainerNameStorage.getContainerName()+".txt"));
                str.removeAll(str);// when using an arraylist that I have used before....I remove ALL of them and then
                //the next line I will add them all back
                while (s.hasNext()) {
                    Food stu = new Food(s.nextLine(), s.nextLine(), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()));
                    stu.checkExpiration();
                    str.add(stu); //this will store each line
                }

                //the following creates an arraylist of buttons
                String TempID = "";
                String tempString = "";

                for (int i = 0; i < str.size(); i++)
                {
                    tempString = tempString +str.get(i).toString() + "\n";

                    // The button way
                    TempID = "food" +i;

                    Button but= new Button(str.get(i).toString());
                    but.setId(TempID);
                    inventory.add(but, 1, i);
                    int currentInd = i;

                    Button removeBut= new Button("x");
                    inventory.add(removeBut, 0, i);
                    removeBut.setOnAction(event -> {
                        str.remove(currentInd);
                        //Create new arraylist
                        while (s.hasNext()) {
                            Food stu = new Food(s.nextLine(), s.nextLine(), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()),Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()));
                            str.add(stu); //this will store each line
                        }
                        s.close();
                        try {
                            //overrides old file
                            Writer v = new FileWriter(UsernameStorage.getUserName() + ContainerNameStorage.getContainerName()+".txt");
                            v.write("");
                            //writes into file
                            Writer w = new FileWriter(UsernameStorage.getUserName() + ContainerNameStorage.getContainerName()+".txt", true);
                            for (int j = 0; j < str.size(); j++) {
                                w.write(str.get(j).writeFood() + "\n");
                            }
                            w.close();
                            new InventoryMenu();
                            secondStage.hide();
                            primaryStage.hide();



                        } catch (Exception e) {
                            System.out.println("error in writing");
                        }

                    });


                }
                inventory.add(searchLabel,1,str.size()+2);
                inventory.add(searchField,1,str.size()+3);
                inventory.add(viewChartB,1,str.size()+4);

            }
            catch(Exception e){System.out.println("error in reading for inventory");}
            secondStage.show();

        });


        //chart root
        PieChart piechart = new PieChart();

        //setting the data of the pie chart.
        piechart.setData(getChartData());

        //Creating Layout
        StackPane chartPie = new StackPane();

        //Adding stuff to gridpane
        chartPie.getChildren().add(piechart);

        viewChartB.setOnAction(value ->
        {
            piechart.setData(getChartData());
            thirdStage.show();
        });



        primaryStage.setTitle("Perishable Container");
        primaryStage.setScene(new Scene(root, 400, 400));
        secondStage.setScene(new Scene(scrollableInventory, 400, 400));
        thirdStage.setScene(new Scene(chartPie,400,400));
        fourthStage.setScene(new Scene(scrollableInventorySearch,400,400));
        primaryStage.show();
    }




    private ObservableList<Data> getChartData() {
        //Get entire arraylist from the txt file
        ArrayList<Food> str = new ArrayList<Food>();
        try {
            Scanner s = new Scanner(new File(UsernameStorage.getUserName()+ContainerNameStorage.getContainerName()+".txt"));
            str.removeAll(str);// when using an arraylist that I have used before....I remove ALL of them and then
            //the next line I will add them all back
            while (s.hasNext()) {
                Food stu = new Food(s.nextLine(), s.nextLine(), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()), Integer.parseInt(s.nextLine()));
                str.add(stu); //this will store each line
            }
        }catch(Exception e){System.out.println("error in reading for getchartdata");}

        ObservableList<Data> list = FXCollections.observableArrayList();


        //Creates Actual Chart
        for (int i = 0; i<str.size();i++)
        {
            list.add(new PieChart.Data(str.get(i).getName(),str.get(i).getAmount()));
        }
        return list;
    }
}
